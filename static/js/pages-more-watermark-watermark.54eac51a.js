(self["webpackChunktdesign_uniapp_vue2_cli"]=self["webpackChunktdesign_uniapp_vue2_cli"]||[]).push([[5073],{1133:function(t,e,a){"use strict";async function r({canvas:t,src:e}){let a=null;return e&&t?(t.createImage&&(a=new Promise((a,r)=>{const n=t.createImage();n.onload=()=>a(n),n.onerror=t=>{console.error("创建图片对象失败:",t),r(t)},n.src=e})),a=new Promise(t=>{uni.getImageInfo({src:e,success:e=>{const a=e.path;t(a)}})}),a=new Promise((t,a)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>t(r),r.onerror=t=>{console.error("图标加载失败:",t),a(t)},r.src=e}),a):a}a.d(e,{y:function(){return r}})},54282:function(t,e,a){var r=a(94279);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var n=a(31997).A;n("3ed21f59",r,!0,{sourceMap:!1,shadowMode:!1})},66812:function(t,e,a){"use strict";var r;a.r(e),a.d(e,{default:function(){return jt}});var n,i,o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-demo-navbar",{attrs:{title:"Watermark"}}),a("v-uni-view",{staticClass:"demo"},[a("t-demo-header",{attrs:{title:"Watermark 水印",desc:"给页面的某个区域加上水印。"}}),a("t-demo",{attrs:{title:"01 组件类型",desc:"文字水印"}},[a("base-watermark")],1),a("t-demo",{attrs:{desc:"图片水印"}},[a("image-watermark")],1),a("t-demo",{attrs:{desc:"图片灰阶水印"}},[a("gray-watermark")],1),a("t-demo",{attrs:{desc:"多行图文水印"}},[a("multi-line-watermark")],1),a("t-demo",{attrs:{desc:"多行图文灰阶水印"}},[a("multi-line-gray-watermark")],1),a("t-demo",{attrs:{desc:"运动文字水印"}},[a("move-text-watermark")],1),a("t-demo",{attrs:{desc:"运动图片水印"}},[a("move-image-watermark")],1),a("t-demo",{attrs:{title:"02 组件样式"}},[a("layout-demo")],1)],1)],1)},s=[],l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,y:56,x:56,width:68,height:52}},[a("v-uni-view",{staticStyle:{width:"100%",height:"340px"}})],1)],1)},m=[],c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{class:t.classPrefix+" "+t.tClass,style:t.tools._style([t.customStyle])},[t.content?[t._v(" "+t._s(t.content)+" ")]:t._e(),t._t("content"),t._t("default"),a("v-uni-canvas",{style:t.canvasStyle,attrs:{id:t.canvasId,"canvas-id":t.canvasId,type:"2d"}}),a("v-uni-view",{class:t.movable?"watermark-move":"",style:t.tools._style(t.watermarkStyle)})],2)},d=[],h=a(1383),u=(a(26128),a(27439),{alpha:{type:Number,default:1},content:{type:String},height:{type:Number},isRepeat:{type:Boolean,default:!0},layout:{type:String,default:"rectangular",validator:function(t){return!t||["rectangular","hexagonal"].includes(t)}},lineSpace:{type:Number,default:16},movable:Boolean,moveInterval:{type:Number,default:3e3},offset:{type:Array},removable:{type:Boolean,default:!0},rotate:{type:Number,default:-22},watermarkContent:{type:[Object,Array]},width:{type:Number},x:{type:Number},y:{type:Number},zIndex:{type:Number}}),w=a(15512),f=a(75070),v=a(16205),p=a(1133);const k=(0,v.jq)().pixelRatio||1,g=(t,e,a,r)=>{t.translate(e,a),t.rotate(Math.PI/180*Number(r)),t.translate(-e,-a)},y=(t,e,a,r,n,i,o,s,l)=>{t.font=`normal normal ${i} ${o*k}px/${r}px ${s}`,t.fillStyle=l,t.textAlign="start",t.textBaseline="top",t.fillText(n,e,a)};async function x(t,e,{width:a,height:r,gapX:n,gapY:i,offsetLeft:o,offsetTop:s,rotate:l,alpha:m,watermarkContent:c,lineSpace:d,watermarkColor:h,layout:u},w,f){const v="hexagonal"===u;let x;if(x=t.getContext("2d",{willReadFrequently:!0}),x||(x=uni.createCanvasContext(e,this)),!x)return console.warn("当前环境不支持Canvas, 无法绘制水印"),void w("");let W={width:n+a};const S=(n+a)*k,$=(i+r)*k,C=a*k,A=r*k,P=S,T=$,M=(n+a)*k,E=(i+r)*k;t.width=S,t.height=$,v&&(t.width=2*S,t.height=2*$,W={width:n+2*a+a/2}),x.globalAlpha=m,x.scale(1/k,1/k),x.fillStyle="transparent",x.fillRect(0,0,C,A),x.translate(o*k,s*k);const N=Array.isArray(c)?c:[{...c}];let z=0;N.forEach(t=>{t.top=z,t.url?z+=r:t.text&&(z+=d)});const G=async(e,n=0,i=0,o=0,s=0)=>{if(e.url){const{url:m,isGrayscale:c=!1}=e,d=await(0,p.y)({canvas:t,src:m});if(x.save?.(),g(x,o,s,l),c){x.drawImage(d,n,i+e.top*k,a*k/2,r*k/2),x.drawImage(d,n,i+e.top*k,a*k,r*k);const t=await _(x,{x:0,y:0,width:a,height:r}),o=t.data;for(let e=0;e<o.length;e+=4){const t=(o[e]+o[e+1]+o[e+2])/3;o[e]=t,o[e+1]=t,o[e+2]=t}await I(x,t,{x:0,y:0})}else x.drawImage(d,n,i+e.top*k,a*k/2,r*k/2),x.drawImage(d,n,i+e.top*k,a*k,r*k);return void x.restore?.()}if(e.text){const{text:t,fontSize:a=16,fontFamily:r="normal",fontWeight:m="normal"}=e,c=e?.fontColor||h;x.save?.(),g(x,o,s,l),y(x,n,i+e.top*k,A,t,m,a,r,c),x.restore?.()}};for(const p of N)await G(p,0,0,0,0);if(v)for(const p of N)await G(p,M,E,P,T);x.draw();const R=await b.call(this,t,e);w(R,W,k),f?.()}function b(t,e){return new Promise((a,r)=>{let n=!1;if(a(t.toDataURL("image/png")),n=!0,n)return;const i=uni.createSelectorQuery().in(this);i.select(`#${e}`).fields({node:!0,size:!0}).exec(async t=>{t[0]?.node?uni.canvasToTempFilePath({canvas:t[0].node,canvasId:e,success:t=>a(t.tempFilePath),fail:r}):console.error("Canvas node not found")})})}async function _(t,e){let a;return a=t.getImageData(e.x,e.y,e.width,e.height),a||(a=new Promise(t=>{uni.canvasGetImageData({canvasId:e.canvasId,x:e.x,y:e.y,width:e.width,height:e.height,success:e=>{t({data:new Uint8ClampedArray(e.data),width:e.width,height:e.height})}},this)})),a}async function I(t,e,a){let r;return t.putImageData(e,a.x,a.y),r=Promise.resolve(),r||(r=new Promise((t,r)=>{uni.canvasPutImageData({canvasId:a.canvasId,x:a.x,y:a.y,width:e.width,height:e.height,data:e.data,success:t,fail:r},this)})),r}function W(){const t=Math.floor(4*Math.random()),e=Math.floor(70*Math.random())+30,a=0,r=95,n=90,i=1===t?n:3===t?a:e,o=0===t?n:2===t?a:100-e,s=1===t?a:3===t?n:100-e,l=0===t?a:2===t?n:e,m=0===t?a:2===t?r:e,c=1===t?r:3===t?a:e,d=0===t?r:2===t?a:100-e,h=1===t?a:3===t?r:100-e;return{left0:`${i}%`,left25:`${o}%`,left50:`${s}%`,left75:`${l}%`,top0:`${m}%`,top25:`${c}%`,top50:`${d}%`,top75:`${h}%`}}const S=`${w.Pl}-watermark`;var $,C,A,P,T,M,E,N,z,G,R,L,X,D,B,F,Y,j=(0,f.o1)({name:S,options:{styleIsolation:"shared"},externalClasses:[`${w.Pl}-class`],props:{...u},data(){return{classPrefix:S,tools:h.A,watermarkStyle:{},initialed:!1,canvasId:`watermark-canvas-${Math.random().toString(36).slice(2,11)}`}},computed:{canvasStyle(){let t="width: 100px; height: 100px;",e=!0;return e&&(t+="display: none;"),t}},watch:{watermarkContent:"renderWatermark",movable:"renderWatermark",rotate:"renderWatermark",x:"renderWatermark",y:"renderWatermark",width:"renderWatermark",height:"renderWatermark",alpha:"renderWatermark",lineSpace:"renderWatermark",moveInterval:"renderWatermark",zIndex:"renderWatermark",offset:"renderWatermark",removable:"renderWatermark",isRepeat:"renderWatermark",layout:"renderWatermark"},async mounted(){await(0,v.dY)(),this.renderWatermark()},methods:{watermarkColor(){return"dark"===v.TX.theme?"rgba(238, 238, 238, 0.1)":"rgba(0, 0, 0, 0.1)"},renderWatermark(){const t=uni.createSelectorQuery().in(this);t.select(`#${this.canvasId}`).fields({node:!0,size:!0}).exec(async t=>{if(!t[0]?.node)return void console.error("Canvas node not found");const e=t[0].node,a=this.movable?0:this.x,r=this.movable?0:this.y,n=this.offset||[],i=n[0]||a/2,o=n[1]||r/2,s={width:this.width,height:this.height,rotate:this.movable?0:this.rotate,lineSpace:this.lineSpace,alpha:this.alpha,gapX:a,gapY:r,watermarkContent:this.watermarkContent,offsetLeft:i,offsetTop:o,watermarkColor:this.watermarkColor(),layout:this.layout};x.call(this,e,this.canvasId,s,(t,e)=>{let r={};if(this.movable){const{left0:t,left25:e,left50:a,left75:n,top0:i,top25:o,top50:s,top75:l}=W();r={"--watermark-left-0":t,"--watermark-left-25":e,"--watermark-left-50":a,"--watermark-left-75":n,"--watermark-top-0":i,"--watermark-top-25":o,"--watermark-top-50":s,"--watermark-top-75":l,"--watermark-animation-duration":4*this.moveInterval/60+"s"}}this.watermarkStyle={zIndex:this.zIndex,position:"absolute",left:0,right:0,top:0,bottom:0,width:"100%",height:"100%",backgroundSize:`${e?.width||a+this.width}px`,pointerEvents:"none",backgroundRepeat:this.movable?"no-repeat":"repeat",backgroundImage:`url('${t}')`,...r}},()=>{this.initialed=!0}).catch(t=>{console.log("e",t)})})}}}),q=j,O=(a(54282),a(1391)),Q=(0,O.A)(q,c,d,!1,null,"bc34a9e2",null,!1,i,$),U=Q.exports,H={components:{TWatermark:U},data:function(){return{watermark:{text:"文字水印"}}}},J=H,K=(0,O.A)(J,l,m,!1,null,"1a298c79",null,!1,n,C),V=K.exports,Z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,width:120,height:20,x:56,y:76}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},tt=[],et={components:{TWatermark:U},data:function(){return{watermark:{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png"}}}},at=et,rt=(0,O.A)(at,Z,tt,!1,null,"6fe28659",null,!1,A,P),nt=rt.exports,it=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,width:120,height:20,x:56,y:76,alpha:.3}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},ot=[],st={components:{TWatermark:U},data:function(){return{watermark:{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png",isGrayscale:!0}}}},lt=st,mt=(0,O.A)(lt,it,ot,!1,null,"737aded8",null,!1,T,M),ct=mt.exports,dt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,"line-space":24,x:56,y:76,width:120,height:20,alpha:.3}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},ht=[],ut={components:{TWatermark:U},data:function(){return{watermark:[{text:"水印文本",fontColor:"black"},{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png"}]}}},wt=ut,ft=(0,O.A)(wt,dt,ht,!1,null,"27bd8281",null,!1,E,N),vt=ft.exports,pt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,"line-space":24,x:56,y:76,width:120,height:20,alpha:.3}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},kt=[],gt={components:{TWatermark:U},data:function(){return{watermark:[{text:"水印文本",fontColor:"black"},{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png",isGrayscale:!0}]}}},yt=gt,xt=(0,O.A)(yt,pt,kt,!1,null,"14f1b49c",null,!1,z,G),bt=xt.exports,_t=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,width:120,height:60,y:200,x:210,movable:!0}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},It=[],Wt={components:{TWatermark:U},data:function(){return{watermark:{text:"文字水印"}}}},St=Wt,$t=(0,O.A)(St,_t,It,!1,null,"6ab99ae2",null,!1,R,L),Ct=$t.exports,At=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,x:100,y:140,width:120,height:30,movable:!0}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},Pt=[],Tt={components:{TWatermark:U},data:function(){return{watermark:{url:"https://tdesign.gtimg.com/site/baseLogo-light.png"}}}},Mt=Tt,Et=(0,O.A)(Mt,At,Pt,!1,null,"44f8a6c3",null,!1,X,D),Nt=Et.exports,zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("v-uni-view",{staticClass:"demo-desc",staticStyle:{"margin-bottom":"32rpx"}},[t._v(" Rectangular Grid 矩形布局 ")]),a("t-watermark",{attrs:{"watermark-content":t.watermark,width:56,height:56,x:68,y:52}},[a("v-uni-view",{staticStyle:{width:"100%",height:"340px"}})],1),a("v-uni-view",{staticClass:"demo-desc",staticStyle:{"margin-bottom":"32rpx"}},[t._v(" Hexagonal Grid 六边形网格 ")]),a("t-watermark",{attrs:{"watermark-content":t.watermark,width:68,height:52,x:56,y:56,layout:"hexagonal"}},[a("v-uni-view",{staticStyle:{width:"100%",height:"340px"}})],1)],1)},Gt=[],Rt={components:{TWatermark:U},data:function(){return{watermark:{text:"文字水印"}}}},Lt=Rt,Xt=(0,O.A)(Lt,zt,Gt,!1,null,"6604a204",null,!1,B,F),Dt=Xt.exports,Bt={components:{BaseWatermark:V,ImageWatermark:nt,GrayWatermark:ct,MultiLineWatermark:vt,MultiLineGrayWatermark:bt,MoveTextWatermark:Ct,MoveImageWatermark:Nt,LayoutDemo:Dt},data:function(){return{}},methods:{}},Ft=Bt,Yt=(0,O.A)(Ft,o,s,!1,null,"fd5be770",null,!1,r,Y),jt=Yt.exports},94279:function(t,e,a){"use strict";a.r(e);var r=a(22093),n=a.n(r),i=a(12670),o=a.n(i),s=o()(n());s.push([t.id,".t-watermark[data-v-bc34a9e2]{position:relative;overflow:hidden;width:100%}@-webkit-keyframes watermark-data-v-bc34a9e2{0%{left:var(--watermark-left-0);top:var(--watermark-top-0)}25%{left:var(--watermark-left-25);top:var(--watermark-top-25)}50%{left:var(--watermark-left-50);top:var(--watermark-top-50);-webkit-transform:translateX(-100%);transform:translateX(-100%)}75%{left:var(--watermark-left-75);top:var(--watermark-top-75)}100%{left:var(--watermark-left-0);top:var(--watermark-top-0)}}@keyframes watermark-data-v-bc34a9e2{0%{left:var(--watermark-left-0);top:var(--watermark-top-0)}25%{left:var(--watermark-left-25);top:var(--watermark-top-25)}50%{left:var(--watermark-left-50);top:var(--watermark-top-50);-webkit-transform:translateX(-100%);transform:translateX(-100%)}75%{left:var(--watermark-left-75);top:var(--watermark-top-75)}100%{left:var(--watermark-left-0);top:var(--watermark-top-0)}}\n/* diff with td-mini */.watermark-move[data-v-bc34a9e2]{-webkit-animation:watermark-data-v-bc34a9e2 var(--watermark-animation-duration,100s) linear infinite;animation:watermark-data-v-bc34a9e2 var(--watermark-animation-duration,100s) linear infinite}",""]),e["default"]=s}}]);