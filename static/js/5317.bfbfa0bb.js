(self["webpackChunktdesign_uniapp_vue2_cli"]=self["webpackChunktdesign_uniapp_vue2_cli"]||[]).push([[5317],{1087:function(t,e,a){"use strict";a.r(e);var i=a(22093),r=a.n(i),s=a(12670),o=a.n(s),n=o()(r());n.push([t.id,'.t-upload[data-v-672b7347]{position:relative}[data-v-672b7347] .t-upload__grid-content{padding:0}[data-v-672b7347] .t-upload__grid-file{position:relative}.t-upload__add-icon[data-v-672b7347]{width:100%;height:100%;display:none;align-items:center;justify-content:center;font-size:var(--td-upload-add-icon-size,28px);background-color:var(--td-upload-add-bg-color,var(--td-bg-color-secondarycontainer,var(--td-gray-color-1,#f3f3f3)));color:var(--td-upload-add-color,var(--td-text-color-placeholder,var(--td-font-gray-3,rgba(0,0,0,.4))));border-radius:var(--td-upload-radius,var(--td-radius-default,6px))}.t-upload__add-icon--disabled[data-v-672b7347]{background-color:var(--td-upload-add-disabled-bg-color,var(--td-bg-color-component-disabled,var(--td-gray-color-2,#eee)));color:var(--td-upload-add-icon-disabled-color,var(--td-text-color-disabled,var(--td-font-gray-4,rgba(0,0,0,.26))))}.t-upload__add-icon[data-v-672b7347]:only-child{display:flex}[data-v-672b7347] .t-upload__thumbnail{width:100%;height:100%;max-height:100%;overflow:hidden}.t-upload__wrapper[data-v-672b7347]{position:relative;border-radius:var(--td-upload-radius,var(--td-radius-default,6px));overflow:hidden}.t-upload__wrapper--disabled[data-v-672b7347]::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--td-upload-disabled-mask,rgba(0,.6));z-index:1}.t-upload__close-btn[data-v-672b7347]{position:absolute;top:0;right:0;display:flex;align-items:center;justify-content:center;width:%?40?%;height:%?40?%;border-top-right-radius:var(--td-upload-radius,var(--td-radius-default,6px));border-bottom-left-radius:var(--td-upload-radius,var(--td-radius-default,6px));background-color:var(--td-font-gray-3,rgba(0,0,0,.4))}.t-upload__progress-mask[data-v-672b7347]{position:absolute;left:0;top:0;width:100%;height:100%;background-color:var(--td-font-gray-2,rgba(0,0,0,.6));display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:var(--td-upload-radius,var(--td-radius-default,6px));color:var(--td-text-color-anti,var(--td-font-white-1,#fff));padding:%?32?% 0;box-sizing:border-box}.t-upload__progress-text[data-v-672b7347]{font:var(--td-font-body-small,12px/20px var(--td-font-family,PingFang SC,Microsoft YaHei,Arial Regular));margin-top:%?8?%}[data-v-672b7347] .t-upload__progress-loading{-webkit-animation:spin-data-v-672b7347 infinite linear .6s;animation:spin-data-v-672b7347 infinite linear .6s}.t-upload__drag[data-v-672b7347]{position:relative;width:100%;--td-grid-item-bg-color:transparent}.t-upload__drag-item[data-v-672b7347]{position:absolute;z-index:1;top:0;left:0;height:auto;width:100%}.t-upload__drag--fixed[data-v-672b7347]{z-index:0}.t-upload__drag--tran[data-v-672b7347]{transition-property:-webkit-transform;transition-property:transform;transition-property:transform,-webkit-transform;transition-duration:var(--td-upload-drag-transition-duration);transition-timing-function:var(--td-upload-drag-transition-timing-function)}.t-upload__drag--cur[data-v-672b7347]{z-index:var(--td-upload-drag-z-index,999)}@-webkit-keyframes spin-data-v-672b7347{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes spin-data-v-672b7347{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}',""]),e["default"]=n},3970:function(t,e,a){var i=a(1087);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var r=a(31997).A;r("2ef63b76",i,!0,{sourceMap:!1,shadowMode:!1})},15317:function(t,e,a){"use strict";var i;a.d(e,{A:function(){return W}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{class:t.classPrefix+" "+t.tClass,style:t.tools._style([t.customStyle])},[a("t-grid",{attrs:{gutter:t.gutter,border:!1,align:"center",column:t.column,"custom-style":t.draggable?"overflow: visible":""}},[t.dragLayout?[a("v-uni-view",{class:t.classPrefix+"__drag",style:t.dragWrapStyle+";",attrs:{list:t.dragList,"drag-base-data":t.dragBaseData}},[t._l(t.customFiles,function(e,i){return a("v-uni-view",{key:i,ref:t.classPrefix+"__drag-item",refInFor:!0,class:t.getDragItemClass(i),style:t.getDragItemStyle(i),attrs:{"data-index":i},on:{longpress:function(e){arguments[0]=e=t.$handleEvent(e),t.parseEventDynamicCode(e,"longPress",i)},touchmove:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.parseEventDynamicCode(e,t.dragging?"touchMove":"",i)},touchend:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.parseEventDynamicCode(e,t.dragging?"touchEnd":"",i)}}},[a("t-grid-item",{attrs:{"t-class":t.classPrefix+"__grid "+t.classPrefix+"__grid-file","t-class-content":t.classPrefix+"__grid-content","aria-role":"presentation","custom-style":"width: 100%"}},[a("v-uni-view",{class:t.classPrefix+"__wrapper "+(t.disabled?t.classPrefix+"__wrapper--disabled":""),style:t.gridItemStyle+";",attrs:{"aria-role":t.ariaRole||t.getWrapperAriaRole(e),"aria-label":t.ariaLabel||t.getWrapperAriaLabel(e)}},["video"!==e.type?a("t-image",{attrs:{"data-file":e,"data-index":i,"t-class":t.classPrefix+"__thumbnail","custom-style":t.imageProps&&t.imageProps.style||"",src:e.thumb||e.url,mode:t.imageProps&&t.imageProps.mode||"aspectFill",error:t.imageProps&&t.imageProps.error||"default",lazy:t.imageProps&&t.imageProps.lazy||!1,loading:t.imageProps&&t.imageProps.loading||"default",shape:t.imageProps&&t.imageProps.shape||"round",webp:t.imageProps&&t.imageProps.webp||!1,"show-menu-by-longpress":t.imageProps&&t.imageProps.showMenuByLongpress||!1},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.onPreview(a,{file:e,index:i})}}}):t._e(),"video"===e.type?a("v-uni-video",{class:t.classPrefix+"__thumbnail",attrs:{src:e.url,poster:e.thumb,controls:!0,autoplay:!1,objectFit:"contain","data-file":e},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onFileClick.apply(void 0,arguments)}}}):t._e(),e.status&&"done"!=e.status?a("v-uni-view",{class:t.classPrefix+"__progress-mask",attrs:{"data-index":i,"data-file":e},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onFileClick.apply(void 0,arguments)}}},["loading"==e.status?[a("t-icon",{attrs:{"t-class":t.classPrefix+"__progress-loading",name:"loading",size:"48rpx","aria-hidden":!0}}),a("v-uni-view",{class:t.classPrefix+"__progress-text"},[t._v(" "+t._s(e.percent?e.percent+"%":"上传中...")+" ")])]:a("t-icon",{attrs:{name:"reload"==e.status?"refresh":"close-circle",size:"48rpx","aria-hidden":!0}}),"reload"==e.status||"failed"==e.status?a("v-uni-view",{class:t.classPrefix+"__progress-text"},[t._v(" "+t._s("reload"==e.status?"重新上传":"上传失败")+" ")]):t._e()],2):t._e(),(t.tools.isBoolean(e.removeBtn)?e.removeBtn:t.removeBtn)?a("v-uni-view",{class:t.classPrefix+"__close-btn hotspot-expanded",attrs:{"data-index":i,"data-url":e.url,"aria-role":"button","aria-label":"删除"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onDelete.apply(void 0,arguments)}}},[a("t-icon",{attrs:{name:"close",size:"32rpx",color:"#fff"}})],1):t._e()],1)],1)],1)}),t.addBtn&&t.customLimit>0?a("v-uni-view",{ref:t.classPrefix+"__drag-item",class:t.getDragItemClass(t.customFiles.length),style:t.getDragItemStyle(t.customFiles.length)},[a("t-grid-item",{attrs:{"t-class":t.classPrefix+"__grid","t-class-content":t.classPrefix+"__grid-content","aria-label":"上传","custom-style":"width: 100%"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onAddTap.apply(void 0,arguments)}}},[a("v-uni-view",{class:t.classPrefix+"__wrapper",style:t.gridItemStyle},[t._t("add-content"),t.addContent?[t._v(" "+t._s(t.addContent)+" ")]:a("v-uni-view",{class:t.classPrefix+"__add-icon "+(t.disabled?t.classPrefix+"__add-icon--disabled":"")},[a("t-icon",{attrs:{name:"add"}})],1)],2)],1)],1):t._e()],2)]:[t._l(t.customFiles,function(e,i){return a("t-grid-item",{key:i,attrs:{"t-class":t.classPrefix+"__grid "+t.classPrefix+"__grid-file","t-class-content":t.classPrefix+"__grid-content","aria-role":"presentation"}},[a("v-uni-view",{class:t.classPrefix+"__wrapper "+(t.disabled?t.classPrefix+"__wrapper--disabled":""),style:t.gridItemStyle,attrs:{"aria-role":t.ariaRole||t.getWrapperAriaRole(e),"aria-label":t.ariaLabel||t.getWrapperAriaLabel(e)}},["video"!==e.type?a("t-image",{attrs:{"data-file":e,"data-index":i,"t-class":t.classPrefix+"__thumbnail","custom-style":t.imageProps&&t.imageProps.style||"",src:e.thumb||e.url,mode:t.imageProps&&t.imageProps.mode||"aspectFill",error:t.imageProps&&t.imageProps.error||"default",lazy:t.imageProps&&t.imageProps.lazy||!1,loading:t.imageProps&&t.imageProps.loading||"default",shape:t.imageProps&&t.imageProps.shape||"round",webp:t.imageProps&&t.imageProps.webp||!1,"show-menu-by-longpress":t.imageProps&&t.imageProps.showMenuByLongpress||!1},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.onPreview(a,{file:e,index:i})}}}):t._e(),"video"===e.type?a("v-uni-video",{class:t.classPrefix+"__thumbnail",attrs:{src:e.url,poster:e.thumb,controls:!0,autoplay:!1,objectFit:"contain","data-file":e},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onFileClick.apply(void 0,arguments)}}}):t._e(),e.status&&"done"!=e.status?a("v-uni-view",{class:t.classPrefix+"__progress-mask",attrs:{"data-index":i,"data-file":e},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onFileClick.apply(void 0,arguments)}}},["loading"==e.status?[a("t-icon",{attrs:{"t-class":t.classPrefix+"__progress-loading",name:"loading",size:"48rpx","aria-hidden":!0}}),a("v-uni-view",{class:t.classPrefix+"__progress-text"},[t._v(" "+t._s(e.percent?e.percent+"%":"上传中...")+" ")])]:a("t-icon",{attrs:{name:"reload"==e.status?"refresh":"close-circle",size:"48rpx","aria-hidden":!0}}),"reload"==e.status||"failed"==e.status?a("v-uni-view",{class:t.classPrefix+"__progress-text"},[t._v(" "+t._s("reload"==e.status?"重新上传":"上传失败")+" ")]):t._e()],2):t._e(),(t.tools.isBoolean(e.removeBtn)?e.removeBtn:t.removeBtn)?a("v-uni-view",{class:t.classPrefix+"__close-btn hotspot-expanded",attrs:{"data-index":i,"aria-role":"button","aria-label":"删除"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onDelete.apply(void 0,arguments)}}},[a("t-icon",{attrs:{name:"close",size:"32rpx",color:"#fff"}})],1):t._e()],1)],1)}),t.addBtn&&t.customLimit>0?a("t-grid-item",{attrs:{"t-class":t.classPrefix+"__grid","t-class-content":t.classPrefix+"__grid-content","aria-label":"上传"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onAddTap.apply(void 0,arguments)}}},[a("v-uni-view",{class:t.classPrefix+"__wrapper",style:t.gridItemStyle},[t._t("add-content"),t.addContent?[t._v(" "+t._s(t.addContent)+" ")]:a("v-uni-view",{class:t.classPrefix+"__add-icon "+(t.disabled?t.classPrefix+"__add-icon--disabled":"")},[a("t-icon",{attrs:{name:"add"}})],1)],2)],1):t._e()]],2)],1)},s=[],o=a(33929),n=a(69838),l=a(4993),d=a(38191),c=a(33913),u=(a(26128),a(27439),{addBtn:{type:Boolean,default:!0},addContent:{type:String},allowUploadDuplicateFile:Boolean,config:{type:Object},disabled:{type:Boolean,default:void 0},draggable:{type:[Boolean,Object]},files:{type:Array},defaultFiles:{type:Array},gridConfig:{type:Object},gutter:{type:Number,default:16},imageProps:{type:Object},max:{type:Number,default:0},mediaType:{type:Array,default:["image","video"]},preview:{type:Boolean,default:!0},removeBtn:{type:Boolean,default:!0},requestMethod:{type:Function},sizeLimit:{type:[Number,Object]},source:{type:String,default:"media",validator:function(t){return!t||["media","messageFile"].includes(t)}},transition:{type:Object,default:function(){return{backTransition:!0,duration:300,timingFunction:"ease"}}},onAdd:{type:Function,default:function(){return{}}},onClick:{type:Function,default:function(){return{}}},onComplete:{type:Function,default:function(){return{}}},onDrop:{type:Function,default:function(){return{}}},onFail:{type:Function,default:function(){return{}}},onRemove:{type:Function,default:function(){return{}}},onSelectChange:{type:Function,default:function(){return{}}},onSuccess:{type:Function,default:function(){return{}}}}),g=a(38207),p=a(56792),h=a(35091),m=a(78282);function f(t){return t.status&&"done"!=t.status?"text":"button"}function v(t){return t.status&&"done"!=t.status?"loading"==t.status?t.percent?`上传中:${t.percent}%`:"上传中":"reload"==t.status?"重新上传":"上传失败":"video"===t.type?"视频":"图像"}let y="",_=0,b=0,x=[];const P=function(t,e,a,i,r,s){return t<0||t>=e||a<0||a>=i||r<0||r>=s},w=function(t,e,a){const i=a.dragBaseData,r=function(t,e){return a.list[t].fixed?(e?--t:++t,r(t,e)):t};let s=-1;return a.list.forEach(t=>{t.sortKey===e&&(s=t.realKey)}),a.list.map(a=>{if(a.fixed)return a;let o=a.sortKey,n=a.realKey;return t<e?o>t&&o<=e?(--n,o=r(--o,!0)):o===t&&(n=s,o=e):t>e&&(o>=e&&o<t?(++n,o=r(++o,!1)):o===t&&(n=s,o=e)),a.sortKey!==o&&(a.tranX=o%i.columns*100+"%",a.tranY=100*Math.floor(o/i.columns)+"%",a.sortKey=o,a.realKey=n),a})};function F(t,e,a){const i=[],r=[];t.forEach(t=>{i[t.sortKey]=t}),i.forEach(t=>{t.extraNode||r.push(t.data)}),a.$emit(e,{listData:r})}function S(t,e){const a=this.getState(),i=a.dragBaseData,r=t.changedTouches[0];if(!r)return;a.cur=e;const s=a.list[a.cur];s&&s.fixed||a.dragging||(a.dragging=!0,this.callMethod("dragStatusChange",{dragging:!0}),a.tranX=1===i.columns?0:r.pageX-(i.itemWidth/2+i.wrapLeft),a.tranY=r.pageY-(i.itemHeight/2+i.wrapTop),a.sId=r.identifier,this.setDragItemStyle(e,`transform: translate3d(${a.tranX}px, ${a.tranY}px, 0)`),a.list.forEach((t,e)=>{this.setDragItemClass(e,"remove",[`${y}__drag--tran`,`${y}__drag--cur`]),this.setDragItemClass(e,"add",e===a.cur?`${y}__drag--cur`:`${y}__drag--tran`)}),this.callMethod("dragVibrate",{vibrateType:"longPress"}))}function L(t,e){const a=this.getState(),i=a.dragBaseData,r=t.changedTouches[0];if(!r)return;if(!a.dragging)return;if(a.sId!==r.identifier)return;const s=1===i.columns?0:r.pageX-(i.itemWidth/2+i.wrapLeft),o=r.pageY-(i.itemHeight/2+i.wrapTop);r.clientY>i.windowHeight-i.itemHeight-i.realBottomSize?this.callMethod("pageScroll",{scrollTop:r.pageY+i.itemHeight-(i.windowHeight-i.realBottomSize)}):r.clientY<i.itemHeight+i.realTopSize&&this.callMethod("pageScroll",{scrollTop:r.pageY-i.itemHeight-i.realTopSize}),this.setDragItemStyle(e,`transform: translate3d(${s}px, ${o}px, 0)`);const n=a.list[a.cur].sortKey,l=Math.round(s/i.itemWidth),d=Math.round(o/i.itemHeight),c=l+i.columns*d,u=a.list[c];u&&u.fixed||P(l,i.columns,d,i.rows,c,a.list.length)||n!==c&&n!==a.preStartKey&&(a.preStartKey=n,x=w(n,c,a),_=n,b=c,a.list.forEach((t,e)=>{const i=x[e];e!==a.cur&&this.setDragItemStyle(e,`transform: translate3d(${i.tranX},${i.tranY}, 0)`)}),this.callMethod("dragVibrate",{vibrateType:"touchMove"}),this.callMethod("dragCollision",{dragCollisionList:x,startIndex:_,endIndex:b}),F(x,"change",this))}function D(t,e){const a=this.getState();a.dragging&&(F(a.list,"sortend",this),this.setDragItemClass(e,"remove",`${y}__drag--cur`),this.setDragItemClass(e,"add",`${y}__drag--tran`),this.setDragItemStyle(e,`transform: translate3d(${a.list[a.cur].tranX},${a.list[a.cur].tranY}, 0)`),a.preStartKey=-1,a.dragging=!1,this.callMethod("dragStatusChange",{dragging:!1}),this.callMethod("dragEnd",{dragCollisionList:x,startIndex:_,endIndex:b}),a.cur=-1,a.tranX=0,a.tranY=0)}function I(t){if(void 0===t)return;const e=this.getState();e.dragBaseData=t,y=t.classPrefix}function $(t){if(void 0===t)return;const e=this.getState();e.list=t||[],e.list.forEach((t,e)=>{this.setDragItemClass(e,"remove",`${y}__drag--tran`),this.setDragItemStyle(e,`transform: translate3d(${t.tranX},${t.tranY}, 0)`),t.fixed&&this.setDragItemClass(e,"add",`${y}__drag--fixed`)}),x=[]}var C=a(71555);const k=`${g.Pl}-upload`,E=()=>[[S,"longPress"],[L,"touchMove"],[D,"touchEnd"],[I,"baseDataObserver"],[$,"listObserver"]].reduce((t,e)=>{const a=e[0];return{...t,[e[1]](...t){a.call(this,...t)}}},{});var M,T=(0,c.o1)({name:k,options:{styleIsolation:"shared"},controlledProps:[{key:"files",event:"success"}],externalClasses:[`${g.Pl}-class`],components:{TGrid:o.A,TGridItem:n.A,TIcon:l.A,TImage:d.A},props:{...u},data(){return{classPrefix:k,prefix:g.Pl,current:!1,proofs:[],customFiles:[],customLimit:0,column:4,dragBaseData:{},rows:0,dragWrapStyle:"",dragList:[],dragging:!0,dragLayout:!1,tools:m.A,gridItemStyle:"",fakeState:{},dragItemClassList:[],dragItemStyleList:[]}},watch:{files:{handler(){this.onWatchFilesLimit()},deep:!0},max:"onWatchFilesLimit",draggable:{handler(){this.onWatchFilesLimit()},deep:!0},gridConfig:{handler(){this.updateGrid()},deep:!0},dragList:{handler(t){setTimeout(()=>{this.listObserver(t)},33)},deep:!0,immediate:!0},dragBaseData:{handler(t){this.baseDataObserver(t)},deep:!0,immediate:!0}},mounted(){this.handleLimit(this.files,this.max),this.updateGrid()},methods:{getWrapperAriaRole:f,getWrapperAriaLabel:v,...E(),handleLimit(t,e){0===e&&(e=Number.MAX_SAFE_INTEGER),this.customFiles=t.length>e?t.slice(0,e):t,this.customLimit=e-t.length,this.dragging=!0,this.initDragLayout()},triggerSuccessEvent(t){this._trigger("success",{files:[...this.customFiles,...t]})},triggerFailEvent(t){this.$emit("fail",t)},onFileClick(t){const{file:e,index:a}=t.currentTarget.dataset;this.$emit("click",{index:a,file:e})},getFileType(t,e,a){if(a)return a;if(1===t.length)return t[0];const i=["avi","wmv","mkv","mp4","mov","rm","3gp","flv","mpg","rmvb"],r=e.split("."),s=r[r.length-1];return i.includes(s.toLocaleLowerCase())?"video":"image"},getRandFileName(t){const e=t.lastIndexOf("."),a=-1===e?"":t.substr(e);return parseInt(`${Date.now()}${Math.floor(900*Math.random()+100)}`,10).toString(36)+a},checkFileSize(t,e,a){if((0,p.wQ)(t,e)){let t=("video"===a?"视频":"图片")+"大小超过限制";if((0,h.Gv)(e)){const{size:a,message:i}=e;t=i?.replace("{sizeLimit}",String(a))}return uni.showToast({icon:"none",title:t}),!0}return!1},onDelete(t){const{index:e}=t.currentTarget.dataset;this.deleteHandle(e)},deleteHandle(t){const{customFiles:e}=this,a=e[t];this.$emit("remove",{index:t,file:a})},updateGrid(){let{gridConfig:t={}}=this;(0,h.Gv)(t)||(t={});const{column:e=4,width:a=160,height:i=160}=t;this.gridItemStyle=`width:${a}rpx;height:${i}rpx`,this.column=e},resetDragLayout(){this.dragBaseData={},this.dragWrapStyle="",this.dragLayout=!1},initDragLayout(){const{draggable:t,disabled:e,customFiles:a}=this;t&&!e&&0!==a.length?(this.initDragList(),setTimeout(()=>{this.initDragBaseData()},33)):this.resetDragLayout()},initDragList(){let t=0;const{column:e,customFiles:a,customLimit:i}=this,r=[];if(a.forEach((a,i)=>{r.push({realKey:t,sortKey:i,tranX:i%e*100+"%",tranY:100*Math.floor(i/e)+"%",data:{...a}}),t+=1}),i>0){const t=r.length;r.push({realKey:t,sortKey:t,tranX:t%e*100+"%",tranY:100*Math.floor(t/e)+"%",fixed:!0})}this.rows=Math.ceil(r.length/e),this.dragList=r},initDragBaseData(){const{classPrefix:t,rows:e,column:a}=this;let i,r,s;i=uni.createSelectorQuery().in(this),i||(i=this.createSelectorQuery()),r=".t-grid-item",s=".t-grid",r||(r=`.${t} >>> .t-grid-item`,s=`.${t} >>> .t-grid`),i.select(r).boundingClientRect(),i.select(s).boundingClientRect(),i.selectViewport().scrollOffset(),i.exec(i=>{const[{width:r,height:s},{left:o,top:n},{scrollTop:l}]=i,d={rows:e,classPrefix:t,itemWidth:r,itemHeight:s,wrapLeft:o,wrapTop:n+l,columns:a},c=`height: ${e*s}px`;this.dragBaseData=d,this.dragWrapStyle=c,this.dragLayout=!0;const u=setTimeout(()=>{this.dragging=!1,clearTimeout(u)},0)})},getPreviewMediaSources(){const t=[];return this.customFiles.forEach(e=>{const a={url:e.url,type:e.type,poster:e.thumb||void 0};t.push(a)}),t},onPreview(t){this.onFileClick(t);const{preview:e}=this;if(!e)return;const a=this.customFiles.some(t=>"video"===t.type);a?this.onPreviewMedia(t):this.onPreviewImage(t)},onPreviewImage(t){const{index:e}=t.currentTarget.dataset,a=this.customFiles.filter(t=>-1!==t.percent).map(t=>t.url),i=this.customFiles[e]?.url;uni.previewImage({urls:a,current:i,fail(){uni.showToast({title:"预览图片失败",icon:"none"})}})},onPreviewMedia(t){const{index:e}=t.currentTarget.dataset,a=this.getPreviewMediaSources();uni.previewMedia({sources:a,current:e,fail(){uni.showToast({title:"预览视频失败",icon:"none"})}})},uploadFiles(t){return Promise.resolve().then(()=>{const e=this.data.requestMethod(t);return e instanceof Promise?e:Promise.resolve({})})},startUpload(t){return"function"===typeof this.requestMethod?this.uploadFiles(t).then(()=>{t.forEach(t=>{t.percent=100}),this.triggerSuccessEvent(t)}).catch(t=>{this.triggerFailEvent(t)}):(this.triggerSuccessEvent(t),this.handleLimit(this.customFiles,this.max),Promise.resolve())},onWatchFilesLimit(){this.handleLimit(this.files,this.max)},onAddTap(){const{disabled:t,mediaType:e,source:a}=this;t||("media"===a?this.chooseMedia(e):this.chooseMessageFile(e))},chooseMedia(t){const{customLimit:e}=this,{config:a,sizeLimit:i}=this;let r="chooseMedia";r="chooseImage",uni[r]({count:Math.min(20,e),mediaType:t,...a,success:e=>{const a=[];e.tempFiles.forEach(e=>{const{size:r,fileType:s,tempFilePath:o,width:n,height:l,duration:d,thumbTempFilePath:c,...u}=e;if(this.checkFileSize(r,i,s))return;const g=e.name||this.getRandFileName(o);a.push({name:g,type:this.getFileType(t,e.name||o,s),url:o,size:r,width:n,height:l,duration:d,thumb:c,percent:0,...u})}),this.afterSelect(a)},fail:t=>{this.triggerFailEvent(t)},complete:t=>{this.$emit("complete",t)}})},chooseMessageFile(t){const{customLimit:e}=this,{config:a,sizeLimit:i}=this;uni.chooseMessageFile({count:Math.min(100,e),type:Array.isArray(t)?"all":t,...a,success:e=>{const a=[];e.tempFiles.forEach(e=>{const{size:r,type:s,path:o,...n}=e;if(this.checkFileSize(r,i,s))return;const l=this.getRandFileName(o);a.push({name:l,type:this.getFileType(t,o,s),url:o,size:r,percent:0,...n})}),this.afterSelect(a)},fail:t=>this.triggerFailEvent(t),complete:t=>this.$emit("complete",t)})},afterSelect(t){this._trigger("select-change",{files:[...this.customFiles],currentSelectedFiles:[t]}),this._trigger("add",{files:t}),this.startUpload(t)},dragVibrate(t){const{vibrateType:e}=t,{draggable:a}=this,i=(0,p.Yc)(a?.vibrate,!0),r=a?.collisionVibrate;(i&&"longPress"===e||r&&"touchMove"===e)&&uni.vibrateShort({type:"light"})},dragStatusChange(t){const{dragging:e}=t;this.dragging=e},dragEnd(t){const{dragCollisionList:e}=t;let a=[];a=0===e.length?this.customFiles:e.reduce((t,e)=>{const{realKey:a,data:i,fixed:r}=e;return r||(t[a]={...i}),t},[]),this.triggerDropEvent(a)},triggerDropEvent(t){const{transition:e}=this;if(e.backTransition){const a=setTimeout(()=>{this.$emit("drop",{files:t}),clearTimeout(a)},e.duration)}else this.$emit("drop",{files:t})},getState(){return this.fakeState||{}},callMethod(...t){return this[t[0]]?.(...t.slice(1))},parseEventDynamicCode:C.s,setDragItemClass(t,e,a){this.dragItemClassList[t]||(this.dragItemClassList[t]=[]);const i=Array.isArray(a)?a:[a];"add"!==e?"remove"===e&&(this.dragItemClassList[t]=this.dragItemClassList[t].filter(t=>!i.includes(t))):this.dragItemClassList[t].push(...i)},getDragItemClass(t){const{classPrefix:e}=this,a=[`${e}__drag-item`];return[...a,...this.dragItemClassList[t]||[]].join(" ")},setDragItemStyle(t,e){this.dragItemStyleList[t]||(this.dragItemStyleList[t]=[]),this.dragItemStyleList[t].push(e)},getDragItemStyle(t){const{column:e,transition:a}=this,i=[`width: ${100/e}%`,`--td-upload-drag-transition-duration: ${a.duration}ms`,`--td-upload-drag-transition-timing-function: ${a.timingFunction}`];return[...i,...this.dragItemStyleList[t]||[]].join(";")}}}),z=T,B=(a(3970),a(1391)),A=(0,B.A)(z,r,s,!1,null,"672b7347",null,!1,i,M),W=A.exports},71555:function(t,e,a){"use strict";function i(t,e,...a){"function"===typeof this[e]&&this[e](t,...a)}a.d(e,{s:function(){return i}})}}]);