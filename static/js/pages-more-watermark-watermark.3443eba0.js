(self["webpackChunktdesign_uniapp_vue2_cli"]=self["webpackChunktdesign_uniapp_vue2_cli"]||[]).push([[5073],{7127:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return Bt}});var r,n={tDemoNavbar:a(27688).A,tDemoHeader:a(5635).A,tDemo:a(23765).A},o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-demo-navbar",{attrs:{title:"Watermark"}}),a("v-uni-view",{staticClass:"demo"},[a("t-demo-header",{attrs:{title:"Watermark 水印",desc:"给页面的某个区域加上水印。"}}),a("t-demo",{attrs:{title:"01 组件类型",desc:"文字水印"}},[a("base-watermark")],1),a("t-demo",{attrs:{desc:"图片水印"}},[a("image-watermark")],1),a("t-demo",{attrs:{desc:"图片灰阶水印"}},[a("gray-watermark")],1),a("t-demo",{attrs:{desc:"多行图文水印"}},[a("multi-line-watermark")],1),a("t-demo",{attrs:{desc:"多行图文灰阶水印"}},[a("multi-line-gray-watermark")],1),a("t-demo",{attrs:{desc:"运动文字水印"}},[a("move-text-watermark")],1),a("t-demo",{attrs:{desc:"运动图片水印"}},[a("move-image-watermark")],1),a("t-demo",{attrs:{title:"02 组件样式"}},[a("layout-demo")],1)],1)],1)},i=[],l={tWatermark:a(88104).A},s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,y:56,x:56,width:68,height:52}},[a("v-uni-view",{staticStyle:{width:"100%",height:"340px"}})],1)],1)},c=[],u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{class:t.classPrefix+" "+t.tClass,style:t.tools._style([t.customStyle])},[t.content?[t._v(" "+t._s(t.content)+" ")]:t._e(),t._t("content"),t._t("default"),a("v-uni-canvas",{style:t.canvasStyle,attrs:{id:t.canvasId,"canvas-id":t.canvasId,type:"2d"}}),a("v-uni-view",{class:t.movable?"watermark-move":"",style:t.tools._style(t.watermarkStyle)})],2)},m=[],f=a(78282),d=(a(26128),a(27439),{alpha:{type:Number,default:1},content:{type:String},height:{type:Number},isRepeat:{type:Boolean,default:!0},layout:{type:String,default:"rectangular",validator:function(t){return!t||["rectangular","hexagonal"].includes(t)}},lineSpace:{type:Number,default:16},movable:Boolean,moveInterval:{type:Number,default:3e3},offset:{type:Array},removable:{type:Boolean,default:!0},rotate:{type:Number,default:-22},watermarkContent:{type:[Object,Array]},width:{type:Number},x:{type:Number},y:{type:Number},zIndex:{type:Number}}),h=a(38207),v=a(33913),w=a(56792),p=a(81750);const k=(0,w.jq)().pixelRatio||1,y=(t,e,a,r)=>{t.translate(e,a),t.rotate(Math.PI/180*Number(r)),t.translate(-e,-a)},g=(t,e,a,r,n,o,i,l,s)=>{t.font=`normal normal ${o} ${i*k}px/${r}px ${l}`,t.fillStyle=s,t.textAlign="start",t.textBaseline="top",t.fillText(n,e,a)};async function b(t,e,{width:a,height:r,gapX:n,gapY:o,offsetLeft:i,offsetTop:l,rotate:s,alpha:c,watermarkContent:u,lineSpace:m,watermarkColor:f,layout:d},h,v){const w="hexagonal"===d;let b;if(b=t.getContext("2d",{willReadFrequently:!0}),b||(b=uni.createCanvasContext(e,this)),!b)return console.warn("当前环境不支持Canvas, 无法绘制水印"),void h("");let W={width:n+a};const S=(n+a)*k,_=(o+r)*k,C=a*k,P=r*k,$=S,T=_,M=(n+a)*k,N=(o+r)*k;t.width=S,t.height=_,w&&(t.width=2*S,t.height=2*_,W={width:n+2*a+a/2}),b.globalAlpha=c,b.scale(1/k,1/k),b.fillStyle="transparent",b.fillRect(0,0,C,P),b.translate(i*k,l*k);const E=Array.isArray(u)?u:[{...u}];let z=0;E.forEach(t=>{t.top=z,t.url?z+=r:t.text&&(z+=m)});const G=async(e,n=0,o=0,i=0,l=0)=>{if(e.url){const{url:c,isGrayscale:u=!1}=e,m=await(0,p.y)({canvas:t,src:c});if(b.save?.(),y(b,i,l,s),u){b.drawImage(m,n,o+e.top*k,a*k/2,r*k/2),b.drawImage(m,n,o+e.top*k,a*k,r*k);const t=await A(b,{x:0,y:0,width:a,height:r}),i=t.data;for(let e=0;e<i.length;e+=4){const t=(i[e]+i[e+1]+i[e+2])/3;i[e]=t,i[e+1]=t,i[e+2]=t}await I(b,t,{x:0,y:0})}else b.drawImage(m,n,o+e.top*k,a*k/2,r*k/2),b.drawImage(m,n,o+e.top*k,a*k,r*k);return void b.restore?.()}if(e.text){const{text:t,fontSize:a=16,fontFamily:r="normal",fontWeight:c="normal"}=e,u=e?.fontColor||f;b.save?.(),y(b,i,l,s),g(b,n,o+e.top*k,P,t,c,a,r,u),b.restore?.()}};for(const p of E)await G(p,0,0,0,0);if(w)for(const p of E)await G(p,M,N,$,T);b.draw();const R=await x.call(this,t,e);h(R,W,k),v?.()}function x(t,e){return new Promise((a,r)=>{let n=!1;if(a(t.toDataURL("image/png")),n=!0,n)return;const o=uni.createSelectorQuery().in(this);o.select(`#${e}`).fields({node:!0,size:!0}).exec(async t=>{t[0]?.node?uni.canvasToTempFilePath({canvas:t[0].node,canvasId:e,success:t=>a(t.tempFilePath),fail:r}):console.error("Canvas node not found")})})}async function A(t,e){let a;return a=t.getImageData(e.x,e.y,e.width,e.height),a||(a=new Promise(t=>{uni.canvasGetImageData({canvasId:e.canvasId,x:e.x,y:e.y,width:e.width,height:e.height,success:e=>{t({data:new Uint8ClampedArray(e.data),width:e.width,height:e.height})}},this)})),a}async function I(t,e,a){let r;return t.putImageData(e,a.x,a.y),r=Promise.resolve(),r||(r=new Promise((t,r)=>{uni.canvasPutImageData({canvasId:a.canvasId,x:a.x,y:a.y,width:e.width,height:e.height,data:e.data,success:t,fail:r},this)})),r}function W(){const t=Math.floor(4*Math.random()),e=Math.floor(70*Math.random())+30,a=0,r=95,n=90,o=1===t?n:3===t?a:e,i=0===t?n:2===t?a:100-e,l=1===t?a:3===t?n:100-e,s=0===t?a:2===t?n:e,c=0===t?a:2===t?r:e,u=1===t?r:3===t?a:e,m=0===t?r:2===t?a:100-e,f=1===t?a:3===t?r:100-e;return{left0:`${o}%`,left25:`${i}%`,left50:`${l}%`,left75:`${s}%`,top0:`${c}%`,top25:`${u}%`,top50:`${m}%`,top75:`${f}%`}}const S=`${h.Pl}-watermark`;var _,C,P,$,T,M,N,E,z,G,R=(0,v.o1)({name:S,options:{styleIsolation:"shared"},externalClasses:[`${h.Pl}-class`],props:{...d},data(){return{classPrefix:S,tools:f.A,watermarkStyle:{},initialed:!1,canvasId:`watermark-canvas-${Math.random().toString(36).slice(2,11)}`}},computed:{canvasStyle(){let t="width: 100px; height: 100px;",e=!0;return e&&(t+="display: none;"),t}},watch:{watermarkContent:"renderWatermark",movable:"renderWatermark",rotate:"renderWatermark",x:"renderWatermark",y:"renderWatermark",width:"renderWatermark",height:"renderWatermark",alpha:"renderWatermark",lineSpace:"renderWatermark",moveInterval:"renderWatermark",zIndex:"renderWatermark",offset:"renderWatermark",removable:"renderWatermark",isRepeat:"renderWatermark",layout:"renderWatermark"},async mounted(){await(0,w.dY)(),this.renderWatermark()},methods:{watermarkColor(){return"dark"===w.TX.theme?"rgba(238, 238, 238, 0.1)":"rgba(0, 0, 0, 0.1)"},renderWatermark(){const t=uni.createSelectorQuery().in(this);t.select(`#${this.canvasId}`).fields({node:!0,size:!0}).exec(async t=>{if(!t[0]?.node)return void console.error("Canvas node not found");const e=t[0].node,a=this.movable?0:this.x,r=this.movable?0:this.y,n=this.offset||[],o=n[0]||a/2,i=n[1]||r/2,l={width:this.width,height:this.height,rotate:this.movable?0:this.rotate,lineSpace:this.lineSpace,alpha:this.alpha,gapX:a,gapY:r,watermarkContent:this.watermarkContent,offsetLeft:o,offsetTop:i,watermarkColor:this.watermarkColor(),layout:this.layout};b.call(this,e,this.canvasId,l,(t,e)=>{let r={};if(this.movable){const{left0:t,left25:e,left50:a,left75:n,top0:o,top25:i,top50:l,top75:s}=W();r={"--watermark-left-0":t,"--watermark-left-25":e,"--watermark-left-50":a,"--watermark-left-75":n,"--watermark-top-0":o,"--watermark-top-25":i,"--watermark-top-50":l,"--watermark-top-75":s,"--watermark-animation-duration":4*this.moveInterval/60+"s"}}this.watermarkStyle={zIndex:this.zIndex,position:"absolute",left:0,right:0,top:0,bottom:0,width:"100%",height:"100%",backgroundSize:`${e?.width||a+this.width}px`,pointerEvents:"none",backgroundRepeat:this.movable?"no-repeat":"repeat",backgroundImage:`url('${t}')`,...r}},()=>{this.initialed=!0}).catch(t=>{console.log("e",t)})})}}}),j=R,D=(a(63117),a(1391)),O=(0,D.A)(j,u,m,!1,null,"5759390e",null,!1,r,_),X=O.exports,F={components:{TWatermark:X},data:function(){return{watermark:{text:"文字水印"}}}},L=F,B=(0,D.A)(L,s,c,!1,null,"1a298c79",null,!1,l,C),Y=B.exports,q={tWatermark:a(88104).A},Q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,width:120,height:20,x:56,y:76}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},U=[],H={components:{TWatermark:X},data:function(){return{watermark:{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png"}}}},J=H,K=(0,D.A)(J,Q,U,!1,null,"6fe28659",null,!1,q,P),V=K.exports,Z={tWatermark:a(88104).A},tt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,width:120,height:20,x:56,y:76,alpha:.3}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},et=[],at={components:{TWatermark:X},data:function(){return{watermark:{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png",isGrayscale:!0}}}},rt=at,nt=(0,D.A)(rt,tt,et,!1,null,"737aded8",null,!1,Z,$),ot=nt.exports,it={tWatermark:a(88104).A},lt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,"line-space":24,x:56,y:76,width:120,height:20,alpha:.3}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},st=[],ct={components:{TWatermark:X},data:function(){return{watermark:[{text:"水印文本",fontColor:"black"},{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png"}]}}},ut=ct,mt=(0,D.A)(ut,lt,st,!1,null,"27bd8281",null,!1,it,T),ft=mt.exports,dt={tWatermark:a(88104).A},ht=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,"line-space":24,x:56,y:76,width:120,height:20,alpha:.3}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},vt=[],wt={components:{TWatermark:X},data:function(){return{watermark:[{text:"水印文本",fontColor:"black"},{url:"https://tdesign.gtimg.com/starter/brand-logo-light.png",isGrayscale:!0}]}}},pt=wt,kt=(0,D.A)(pt,ht,vt,!1,null,"14f1b49c",null,!1,dt,M),yt=kt.exports,gt={tWatermark:a(88104).A},bt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,width:120,height:60,y:200,x:210,movable:!0}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},xt=[],At={components:{TWatermark:X},data:function(){return{watermark:{text:"文字水印"}}}},It=At,Wt=(0,D.A)(It,bt,xt,!1,null,"6ab99ae2",null,!1,gt,N),St=Wt.exports,_t={tWatermark:a(88104).A},Ct=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("t-watermark",{attrs:{"watermark-content":t.watermark,x:100,y:140,width:120,height:30,movable:!0}},[a("v-uni-view",{staticStyle:{width:"100%",height:"300px"}})],1)],1)},Pt=[],$t={components:{TWatermark:X},data:function(){return{watermark:{url:"https://tdesign.gtimg.com/site/baseLogo-light.png"}}}},Tt=$t,Mt=(0,D.A)(Tt,Ct,Pt,!1,null,"44f8a6c3",null,!1,_t,E),Nt=Mt.exports,Et={tWatermark:a(88104).A},zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("v-uni-view",{staticClass:"demo-desc",staticStyle:{"margin-bottom":"32rpx"}},[t._v(" Rectangular Grid 矩形布局 ")]),a("t-watermark",{attrs:{"watermark-content":t.watermark,width:56,height:56,x:68,y:52}},[a("v-uni-view",{staticStyle:{width:"100%",height:"340px"}})],1),a("v-uni-view",{staticClass:"demo-desc",staticStyle:{"margin-bottom":"32rpx"}},[t._v(" Hexagonal Grid 六边形网格 ")]),a("t-watermark",{attrs:{"watermark-content":t.watermark,width:68,height:52,x:56,y:56,layout:"hexagonal"}},[a("v-uni-view",{staticStyle:{width:"100%",height:"340px"}})],1)],1)},Gt=[],Rt={components:{TWatermark:X},data:function(){return{watermark:{text:"文字水印"}}}},jt=Rt,Dt=(0,D.A)(jt,zt,Gt,!1,null,"6604a204",null,!1,Et,z),Ot=Dt.exports,Xt={components:{BaseWatermark:Y,ImageWatermark:V,GrayWatermark:ot,MultiLineWatermark:ft,MultiLineGrayWatermark:yt,MoveTextWatermark:St,MoveImageWatermark:Nt,LayoutDemo:Ot},data:function(){return{}},methods:{}},Ft=Xt,Lt=(0,D.A)(Ft,o,i,!1,null,"fd5be770",null,!1,n,G),Bt=Lt.exports},8206:function(t,e,a){"use strict";a.d(e,{A:function(){return n}});a(8248),a(50928),a(51470),a(6761),a(53439),a(77332),a(39221),a(57100);var r=a(28737);function n(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=(0,r.A)(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,s=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return l=t.done,t},e:function(t){s=!0,i=t},f:function(){try{l||null==a["return"]||a["return"]()}finally{if(s)throw i}}}}},24393:function(t,e,a){var r=a(34588);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var n=a(31997).A;n("35bab4ad",r,!0,{sourceMap:!1,shadowMode:!1})},34588:function(t,e,a){"use strict";a.r(e);var r=a(22093),n=a.n(r),o=a(12670),i=a.n(o),l=i()(n());l.push([t.id,".t-watermark[data-v-f85d6208]{position:relative;overflow:hidden;width:100%}@-webkit-keyframes watermark-data-v-f85d6208{0%{left:var(--watermark-left-0);top:var(--watermark-top-0)}25%{left:var(--watermark-left-25);top:var(--watermark-top-25)}50%{left:var(--watermark-left-50);top:var(--watermark-top-50);-webkit-transform:translateX(-100%);transform:translateX(-100%)}75%{left:var(--watermark-left-75);top:var(--watermark-top-75)}100%{left:var(--watermark-left-0);top:var(--watermark-top-0)}}@keyframes watermark-data-v-f85d6208{0%{left:var(--watermark-left-0);top:var(--watermark-top-0)}25%{left:var(--watermark-left-25);top:var(--watermark-top-25)}50%{left:var(--watermark-left-50);top:var(--watermark-top-50);-webkit-transform:translateX(-100%);transform:translateX(-100%)}75%{left:var(--watermark-left-75);top:var(--watermark-top-75)}100%{left:var(--watermark-left-0);top:var(--watermark-top-0)}}\n/* diff with td-mini */.watermark-move[data-v-f85d6208]{-webkit-animation:watermark-data-v-f85d6208 var(--watermark-animation-duration,100s) linear infinite;animation:watermark-data-v-f85d6208 var(--watermark-animation-duration,100s) linear infinite}",""]),e["default"]=l},35927:function(t,e,a){"use strict";a.d(e,{A:function(){return n}});a(8248),a(50928),a(6761),a(53439),a(91802),a(67054),a(77332),a(578);function r(t,e,a,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}r=function(t,e,a,n){function i(e,a){r(t,e,function(t){return this._invoke(e,a,t)})}e?o?o(t,e,{value:a,enumerable:!n,configurable:!n,writable:!n}):t[e]=a:(i("next",0),i("throw",1),i("return",2))},r(t,e,a,n)}function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var t,e,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function l(a,n,o,i){var l=n&&n.prototype instanceof c?n:c,u=Object.create(l.prototype);return r(u,"_invoke",function(a,r,n){var o,i,l,c=0,u=n||[],m=!1,f={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,a){return o=e,i=0,l=t,f.n=a,s}};function d(a,r){for(i=a,l=r,e=0;!m&&c&&!n&&e<u.length;e++){var n,o=u[e],d=f.p,h=o[2];a>3?(n=h===r)&&(l=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=t):o[0]<=d&&((n=a<2&&d<o[1])?(i=0,f.v=r,f.n=o[1]):d<h&&(n=a<3||o[0]>r||r>h)&&(o[4]=a,o[5]=r,f.n=h,i=0))}if(n||a>1)return s;throw m=!0,r}return function(n,u,h){if(c>1)throw TypeError("Generator is already running");for(m&&1===u&&d(u,h),i=u,l=h;(e=i<2?t:l)||!m;){o||(i?i<3?(i>1&&(f.n=-1),d(i,l)):f.n=l:f.v=l);try{if(c=2,o){if(i||(n="next"),e=o[n]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,i<2&&(i=0)}else 1===i&&(e=o["return"])&&e.call(o),i<2&&(l=TypeError("The iterator does not provide a '"+n+"' method"),i=1);o=t}else if((e=(m=f.n<0)?l:a.call(r,f))!==s)break}catch(e){o=t,i=1,l=e}finally{c=1}}return{value:e,done:m}}}(a,o,i),!0),u}var s={};function c(){}function u(){}function m(){}e=Object.getPrototypeOf;var f=[][o]?e(e([][o]())):(r(e={},o,function(){return this}),e),d=m.prototype=c.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,r(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=m,r(d,"constructor",m),r(m,"constructor",u),u.displayName="GeneratorFunction",r(m,i,"GeneratorFunction"),r(d),r(d,i,"Generator"),r(d,o,function(){return this}),r(d,"toString",function(){return"[object Generator]"}),(n=function(){return{w:l,m:h}})()}},38730:function(t,e,a){"use strict";a.d(e,{A:function(){return n}});a(77332);function r(t,e,a,r,n,o,i){try{var l=t[o](i),s=l.value}catch(t){return void a(t)}l.done?e(s):Promise.resolve(s).then(r,n)}function n(t){return function(){var e=this,a=arguments;return new Promise(function(n,o){var i=t.apply(e,a);function l(t){r(i,n,o,l,s,"next",t)}function s(t){r(i,n,o,l,s,"throw",t)}l(void 0)})}}},60344:function(t,e,a){"use strict";a.r(e);var r=a(22093),n=a.n(r),o=a(12670),i=a.n(o),l=i()(n());l.push([t.id,".t-watermark[data-v-5759390e]{position:relative;overflow:hidden;width:100%}@-webkit-keyframes watermark-data-v-5759390e{0%{left:var(--watermark-left-0);top:var(--watermark-top-0)}25%{left:var(--watermark-left-25);top:var(--watermark-top-25)}50%{left:var(--watermark-left-50);top:var(--watermark-top-50);-webkit-transform:translateX(-100%);transform:translateX(-100%)}75%{left:var(--watermark-left-75);top:var(--watermark-top-75)}100%{left:var(--watermark-left-0);top:var(--watermark-top-0)}}@keyframes watermark-data-v-5759390e{0%{left:var(--watermark-left-0);top:var(--watermark-top-0)}25%{left:var(--watermark-left-25);top:var(--watermark-top-25)}50%{left:var(--watermark-left-50);top:var(--watermark-top-50);-webkit-transform:translateX(-100%);transform:translateX(-100%)}75%{left:var(--watermark-left-75);top:var(--watermark-top-75)}100%{left:var(--watermark-left-0);top:var(--watermark-top-0)}}\n/* diff with td-mini */.watermark-move[data-v-5759390e]{-webkit-animation:watermark-data-v-5759390e var(--watermark-animation-duration,100s) linear infinite;animation:watermark-data-v-5759390e var(--watermark-animation-duration,100s) linear infinite}",""]),e["default"]=l},63117:function(t,e,a){var r=a(60344);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var n=a(31997).A;n("213edc9c",r,!0,{sourceMap:!1,shadowMode:!1})},81750:function(t,e,a){"use strict";async function r({canvas:t,src:e}){let a=null;return e&&t?(t.createImage&&(a=new Promise((a,r)=>{const n=t.createImage();n.onload=()=>a(n),n.onerror=t=>{console.error("创建图片对象失败:",t),r(t)},n.src=e})),a=new Promise(t=>{uni.getImageInfo({src:e,success:e=>{const a=e.path;t(a)}})}),a=new Promise((t,a)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>t(r),r.onerror=t=>{console.error("图标加载失败:",t),a(t)},r.src=e}),a):a}a.d(e,{y:function(){return r}})},88104:function(t,e,a){"use strict";var r;a.d(e,{A:function(){return N}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{class:t.classPrefix+" "+t.tClass,style:t.tools._style([t.customStyle])},[t.content?[t._v(" "+t._s(t.content)+" ")]:t._e(),t._t("content"),t._t("default"),a("v-uni-canvas",{style:t.canvasStyle,attrs:{id:t.canvasId,"canvas-id":t.canvasId,type:"2d"}}),a("v-uni-view",{class:t.movable?"watermark-move":"",style:t.tools._style(t.watermarkStyle)})],2)},o=[],i=a(35927),l=a(38730),s=a(70012),c=(a(53439),a(14255),a(77332),a(47402),a(41790),a(10263)),u=(a(26128),a(27439),{alpha:{type:Number,default:1},content:{type:String},height:{type:Number},isRepeat:{type:Boolean,default:!0},layout:{type:String,default:"rectangular",validator:function(t){return!t||["rectangular","hexagonal"].includes(t)}},lineSpace:{type:Number,default:16},movable:Boolean,moveInterval:{type:Number,default:3e3},offset:{type:Array},removable:{type:Boolean,default:!0},rotate:{type:Number,default:-22},watermarkContent:{type:[Object,Array]},width:{type:Number},x:{type:Number},y:{type:Number},zIndex:{type:Number}}),m=a(46056),f=a(88070),d=a(11005),h=a(8206),v=(a(73645),a(98304),a(69870),a(26972),a(74133),a(41469),a(17932),a(19329),a(67103),a(54211),a(4731),a(90231),a(38659),a(47552),a(54185),a(58012),a(83630),a(73923),a(39557),a(40303),a(46644),a(27608),a(35870),a(2945),a(1974),a(35824),a(76135),a(48914),a(5316),a(31958),a(97238),a(78070),a(25710),a(73926),a(83137),a(5829),a(14318),a(25241),a(97245)),w=(0,d.jq)().pixelRatio||1,p=function(t,e,a,r){t.translate(e,a),t.rotate(Math.PI/180*Number(r)),t.translate(-e,-a)},k=function(t,e,a,r,n,o,i,l,s){t.font="normal normal ".concat(o," ").concat(i*w,"px/").concat(r,"px ").concat(l),t.fillStyle=s,t.textAlign="start",t.textBaseline="top",t.fillText(n,e,a)};function y(t,e,a,r,n){return g.apply(this,arguments)}function g(){return g=(0,l.A)((0,i.A)().m(function t(e,a,r,n,o){var c,u,m,f,d,y,g,A,W,S,_,C,P,$,T,M,N,E,z,G,R,j,D,O,X,F,L,B,Y,q,Q,U,H,J,K;return(0,i.A)().w(function(t){while(1)switch(t.p=t.n){case 0:if(c=r.width,u=r.height,m=r.gapX,f=r.gapY,d=r.offsetLeft,y=r.offsetTop,g=r.rotate,A=r.alpha,W=r.watermarkContent,S=r.lineSpace,_=r.watermarkColor,C=r.layout,P="hexagonal"===C,$=e.getContext("2d",{willReadFrequently:!0}),$||($=uni.createCanvasContext(a,this)),$){t.n=1;break}return console.warn("当前环境不支持Canvas, 无法绘制水印"),n(""),t.a(2);case 1:T={width:m+c},M=(m+c)*w,N=(f+u)*w,E=c*w,z=u*w,G=M,R=N,j=(m+c)*w,D=(f+u)*w,e.width=M,e.height=N,P&&(e.width=2*M,e.height=2*N,T={width:m+2*c+c/2}),$.globalAlpha=A,$.scale(1/w,1/w),$.fillStyle="transparent",$.fillRect(0,0,E,z),$.translate(d*w,y*w),O=Array.isArray(W)?W:[(0,s.A)({},W)],X=0,O.forEach(function(t){t.top=X,t.url?X+=u:t.text&&(X+=S)}),F=function(){var t=(0,l.A)((0,i.A)().m(function t(a){var r,n,o,l,s,m,f,d,h,y,b,A,W,S,C,P,T,M,N,E,G,R,j,D,O,X,F,L,B=arguments;return(0,i.A)().w(function(t){while(1)switch(t.n){case 0:if(r=B.length>1&&void 0!==B[1]?B[1]:0,n=B.length>2&&void 0!==B[2]?B[2]:0,o=B.length>3&&void 0!==B[3]?B[3]:0,l=B.length>4&&void 0!==B[4]?B[4]:0,!a.url){t.n=6;break}return h=a.url,y=a.isGrayscale,b=void 0!==y&&y,t.n=1,(0,v.y)({canvas:e,src:h});case 1:if(A=t.v,null===(s=(m=$).save)||void 0===s||s.call(m),p($,o,l,g),!b){t.n=4;break}return $.drawImage(A,r,n+a.top*w,c*w,u*w),t.n=2,x($,{x:0,y:0,width:c,height:u});case 2:for(W=t.v,S=W.data,C=0;C<S.length;C+=4)P=(S[C]+S[C+1]+S[C+2])/3,S[C]=P,S[C+1]=P,S[C+2]=P;return t.n=3,I($,W,{x:0,y:0});case 3:t.n=5;break;case 4:$.drawImage(A,r,n+a.top*w,c*w,u*w);case 5:return null===(f=(d=$).restore)||void 0===f||f.call(d),t.a(2);case 6:a.text&&(G=a.text,R=a.fontSize,j=void 0===R?16:R,D=a.fontFamily,O=void 0===D?"normal":D,X=a.fontWeight,F=void 0===X?"normal":X,L=(null===a||void 0===a?void 0:a.fontColor)||_,null===(T=(M=$).save)||void 0===T||T.call(M),p($,o,l,g),k($,r,n+a.top*w,z,G,F,j,O,L),null===(N=(E=$).restore)||void 0===N||N.call(E));case 7:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),L=(0,h.A)(O),t.p=2,L.s();case 3:if((B=L.n()).done){t.n=5;break}return Y=B.value,t.n=4,F(Y,0,0,0,0);case 4:t.n=3;break;case 5:t.n=7;break;case 6:t.p=6,J=t.v,L.e(J);case 7:return t.p=7,L.f(),t.f(7);case 8:if(!P){t.n=15;break}q=(0,h.A)(O),t.p=9,q.s();case 10:if((Q=q.n()).done){t.n=12;break}return U=Q.value,t.n=11,F(U,j,D,G,R);case 11:t.n=10;break;case 12:t.n=14;break;case 13:t.p=13,K=t.v,q.e(K);case 14:return t.p=14,q.f(),t.f(14);case 15:return t.n=16,b.call(this,e,a);case 16:H=t.v,n(H,T,w),null===o||void 0===o||o();case 17:return t.a(2)}},t,this,[[9,13,14,15],[2,6,7,8]])})),g.apply(this,arguments)}function b(t,e){var a=this;return new Promise(function(r,n){var o=!1;if(r(t.toDataURL("image/png")),o=!0,!o){var s=uni.createSelectorQuery().in(a);s.select("#".concat(e)).fields({node:!0,size:!0}).exec(function(){var t=(0,l.A)((0,i.A)().m(function t(a){var o;return(0,i.A)().w(function(t){while(1)switch(t.n){case 0:if(null!==(o=a[0])&&void 0!==o&&o.node){t.n=1;break}return console.error("Canvas node not found"),t.a(2);case 1:uni.canvasToTempFilePath({canvasId:e,success:function(t){return r(t.tempFilePath)},fail:n});case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())}})}function x(t,e){return A.apply(this,arguments)}function A(){return A=(0,l.A)((0,i.A)().m(function t(e,a){var r,n=this;return(0,i.A)().w(function(t){while(1)switch(t.n){case 0:return r=e.getImageData(a.x,a.y,a.width,a.height),r||(r=new Promise(function(t){uni.canvasGetImageData({canvasId:a.canvasId,x:a.x,y:a.y,width:a.width,height:a.height,success:function(e){t({data:new Uint8ClampedArray(e.data),width:e.width,height:e.height})}},n)})),t.a(2,r)}},t)})),A.apply(this,arguments)}function I(t,e,a){return W.apply(this,arguments)}function W(){return W=(0,l.A)((0,i.A)().m(function t(e,a,r){var n,o=this;return(0,i.A)().w(function(t){while(1)switch(t.n){case 0:return e.putImageData(a,r.x,r.y),n=Promise.resolve(),n||(n=new Promise(function(t,e){uni.canvasPutImageData({canvasId:r.canvasId,x:r.x,y:r.y,width:a.width,height:a.height,data:a.data,success:t,fail:e},o)})),t.a(2,n)}},t)})),W.apply(this,arguments)}function S(){var t=Math.floor(4*Math.random()),e=Math.floor(70*Math.random())+30,a=0,r=95,n=90,o=1===t?n:3===t?a:e,i=0===t?n:2===t?a:100-e,l=1===t?a:3===t?n:100-e,s=0===t?a:2===t?n:e,c=0===t?a:2===t?r:e,u=1===t?r:3===t?a:e,m=0===t?r:2===t?a:100-e,f=1===t?a:3===t?r:100-e;return{left0:"".concat(o,"%"),left25:"".concat(i,"%"),left50:"".concat(l,"%"),left75:"".concat(s,"%"),top0:"".concat(c,"%"),top25:"".concat(u,"%"),top50:"".concat(m,"%"),top75:"".concat(f,"%")}}var _,C="".concat(m.Pl,"-watermark"),P=(0,f.o1)({name:C,options:{styleIsolation:"shared"},externalClasses:["".concat(m.Pl,"-class")],props:(0,s.A)({},u),data:function(){return{classPrefix:C,tools:c.A,watermarkStyle:{},initialed:!1,canvasId:"watermark-canvas-".concat(Math.random().toString(36).slice(2,11))}},computed:{canvasStyle:function(){var t="width: 100px; height: 100px;",e=!0;return e&&(t+="display: none;"),t}},watch:{watermarkContent:"renderWatermark",movable:"renderWatermark",rotate:"renderWatermark",x:"renderWatermark",y:"renderWatermark",width:"renderWatermark",height:"renderWatermark",alpha:"renderWatermark",lineSpace:"renderWatermark",moveInterval:"renderWatermark",zIndex:"renderWatermark",offset:"renderWatermark",removable:"renderWatermark",isRepeat:"renderWatermark",layout:"renderWatermark"},mounted:function(){var t=this;return(0,l.A)((0,i.A)().m(function e(){return(0,i.A)().w(function(e){while(1)switch(e.n){case 0:return e.n=1,(0,d.dY)();case 1:t.renderWatermark();case 2:return e.a(2)}},e)}))()},methods:{watermarkColor:function(){return"dark"===d.TX.theme?"rgba(238, 238, 238, 0.1)":"rgba(0, 0, 0, 0.1)"},renderWatermark:function(){var t=this,e=uni.createSelectorQuery().in(this);e.select("#".concat(this.canvasId)).fields({node:!0,size:!0}).exec(function(){var e=(0,l.A)((0,i.A)().m(function e(a){var r,n,o,l,c,u,m,f;return(0,i.A)().w(function(e){while(1)switch(e.n){case 0:if(null!==(r=a[0])&&void 0!==r&&r.node){e.n=1;break}return console.error("Canvas node not found"),e.a(2);case 1:n=a[0].node,o=t.movable?0:t.x,l=t.movable?0:t.y,c=t.offset||[],u=c[0]||o/2,m=c[1]||l/2,f={width:t.width,height:t.height,rotate:t.movable?0:t.rotate,lineSpace:t.lineSpace,alpha:t.alpha,gapX:o,gapY:l,watermarkContent:t.watermarkContent,offsetLeft:u,offsetTop:m,watermarkColor:t.watermarkColor(),layout:t.layout},y.call(t,n,t.canvasId,f,function(e,a){var r={};if(t.movable){var n=S(),i=n.left0,l=n.left25,c=n.left50,u=n.left75,m=n.top0,f=n.top25,d=n.top50,h=n.top75;r={"--watermark-left-0":i,"--watermark-left-25":l,"--watermark-left-50":c,"--watermark-left-75":u,"--watermark-top-0":m,"--watermark-top-25":f,"--watermark-top-50":d,"--watermark-top-75":h,"--watermark-animation-duration":"".concat(4*t.moveInterval/60,"s")}}t.watermarkStyle=(0,s.A)({zIndex:t.zIndex,position:"absolute",left:0,right:0,top:0,bottom:0,width:"100%",height:"100%",backgroundSize:"".concat((null===a||void 0===a?void 0:a.width)||o+t.width,"px"),pointerEvents:"none",backgroundRepeat:t.movable?"no-repeat":"repeat",backgroundImage:"url('".concat(e,"')")},r)},function(){t.initialed=!0}).catch(function(t){console.log("e",t)});case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())}}}),$=P,T=(a(24393),a(1391)),M=(0,T.A)($,n,o,!1,null,"f85d6208",null,!1,r,_),N=M.exports},97245:function(t,e,a){"use strict";a.d(e,{y:function(){return o}});var r=a(35927),n=a(38730);a(77332);function o(t){return i.apply(this,arguments)}function i(){return i=(0,n.A)((0,r.A)().m(function t(e){var a,n,o;return(0,r.A)().w(function(t){while(1)switch(t.n){case 0:if(a=e.canvas,n=e.src,o=null,n&&a){t.n=1;break}return t.a(2,o);case 1:return o=new Promise(function(t,e){var a=new Image;a.crossOrigin="anonymous",a.onload=function(){return t(a)},a.onerror=function(t){console.error("图标加载失败:",t),e(t)},a.src=n}),t.a(2,o)}},t)})),i.apply(this,arguments)}}}]);